---
title: Session 1. Detection of Malicious Code Variants Based on Deep Learning
date: 2019-06-27 00:00:00 Z
description: Detection of Malicious Code Variants Based on Deep Learning
card_title: Session 1
card_teaser: Detection of Malicious Code Variants Based on Deep Learning
card_position: 1
icon: fa-server
categories: [seminars,06-27-2019-morning-seminar,presentation]
tags: [TII, 2018, TII2018, Malware variants, grayscale image, deep learning, convolution neural network, bat algorithm]
sidebar: morning-seminar
layout: default
slug: ms-presentation-hy-june-27-2019
permalink: /:categories/:slug.html
---

{% assign product = 'ce' %}
{% include layout/row_start.html %}
{% include layout/col_start.html column="7" %}

## Presenter & Date
+ Hee-Yong Kwon (권희용)
+ 2019-06-27

## [Automated Website Fingerprinting through Deep Learning](https://inhaucs.github.io/seminars/06-27-2019-morning-seminar/presentation/ms-presentation-sy-june-27-2019.html)

### Information of the paper [(Link)](https://arxiv.org/pdf/1708.06376)
+ Authors: Vera Rimmer; Davy Preuveneers; Marc Juarez; Tom Van Goethem; Wouter Joosen (KU Leuven)
+ **Conference** name: Network and Distributed System Security Symposium 2018 (NDSS 2018)
+ Published date: 2017-12-05
+ [Paper Link](https://arxiv.org/pdf/1708.06376.pdf)


### Abstract
Several studies have shown that the network traffic that is generated by a visit to a website over Tor reveals information specific to the website through the timing and sizes of network packets. By capturing traffic traces between users and their Tor entry guard, a network eavesdropper can leverage this meta-data to reveal which website Tor users are visiting. The success of such attacks heavily depends on the particular set of traffic features that are used to construct the fingerprint. Typically, these features are manually engineered and, as such, any change introduced to the Tor network can render these carefully constructed features ineffective. In this paper, we show that an adversary can automate the feature engineering process, and thus automatically deanonymize Tor traffic by applying our novel method based on deep learning. We collect a dataset comprised of more than three million network traces, which is the largest dataset of web traffic ever used for website fingerprinting, and find that the performance achieved by our deep learning approaches is comparable to known methods which include various research efforts spanning over multiple years. The obtained success rate exceeds 96% for a closed world of 100 websites and 94% for our biggest closed world of 900 classes. In our open world evaluation, the most performant deep learning model is 2% more accurate than the state-of the-art attack. Furthermore, we show that the implicit features automatically learned by our approach are far more resilient to dynamic changes of web content over time. We conclude that the ability to automatically construct the most relevant traffic features and perform accurate traffic recognition makes our deep learning based approach an efficient, flexible and robust technique for website fingerprinting.


## Summary (Korean)
+ 사용자의 프라이버시를 보호하는 Onion Router (Tor) -> 컨텐츠 라우팅 정보등을 암호화 -> 유저가 방문한 사이트를 알 수 없음
+ 기존에도 Tor traffic으로부터 Website Figerprinting 가능 (Traffic으로부터 유저가 어느 website에 방문했는지)
  + 그러나 기존의 기술들은 사전작업으로 특징 가공이 필요 (Feature Engineering) -> 직관과 전문적인 지식에 따른 수작업
    + 특정 feature set 사용
    + 이 경우, feature를 왜곡하는 것에 민감
    + 때문에 공격 vs. 수비의 Arms-race(군비경쟁)
+ (In this paper) Deep Learning에 기반한 새로운 WF 공격 제안
  + **자동** 특징 학습 -> Traffic에 따라 자동으로 특징을 학습하기 때문에 Arms-race 탈출 가능
  + 첫 자동화된 WF 공격이며, state-of-the-art manual approaches들만큼 좋음
+ ***Contributions***
  + WF에 체계적으로 DL 알고리즘을 적용한 첫 연구
    + 또한 최적의 hyperparameters를 찾기 위해 모델 선택을 자동화 함
  + 기존의 연구들을 자신들의 데이터셋에 맞추어 다시 평가하였더니 더 좋은 결과가 나옴을 보이고, 제안하는 방법이 최신 연구보다 2% 가량 성능이 향상됨을 보임
  + 지금까지의 WF attack dataset 중에 가장 큰 dataset 사용
    + Closed-world dataset: 존재하지 않는 정보는 모른다, 900 websites, 2,500 visits each
    + Open-world dataset: 존재하지 않는 정보는 틀리다, 400,000 unknown websites and 200 monitored websites
    + Access (dataset & implementation): https://distrinet.cs.kuleuven.be/software/tor-wf-dl/

## Related Works
+ 비교 대상
  + Wang-kNN[[WCN+14]]
    + k-NN 사용
    + 100 개의 웹사이트들에 대해 90-95% 공격 달성
  + CUMUL[[PLZ+16]]
    + Radial Basis Function (RBF) kernel을 사용한 SVM 사용
    + 패킷 길이의 누적합 사용(나가는 패킷 - 들어오는 패킷)과 패킷의 개수 사용
    + 100 개의 웹사이트들에 대해 90-93 % 공격 달성
  + k-Fingerprinting(k-FP)[[HD16]]
    + Random Forests 사용
    + 100 개의 웹사이트들에 대해 90-93 % 공격 달성

[WCN+14]: <https://www.usenix.org/conference/usenixsecurity14/technical-sessions/presentation/wang_tao> "T. Wang, X. Cai, R. Nithyanand, R. Johnson, and I. Goldberg, “Effective Attacks and Provable Defenses for Website Fingerprinting,” in USENIX Security Symposium. USENIX Association, 2014, pp. 143–157."
[PLZ+16]: <https://nymity.ch/tor-dns/pdf/Panchenko2016a.pdf> "A. Panchenko, F. Lanze, A. Zinnen, M. Henze, J. Pennekamp, K.Wehrle, and T. Engel, “Website fingerprinting at internet scale,” in Network & Distributed System Security Symposium (NDSS). IEEE Computer Society, 2016, pp. 1–15."
[HD16]: <https://www.usenix.org/conference/usenixsecurity16/technical-sessions/presentation/hayes> "J. Hayes and G. Danezis, “k-fingerprinting: a Robust Scalable Website Fingerprinting Technique,” in USENIX Security Symposium. USENIX Association, 2016, pp. 1–17."

## Threat Model
+ 이전 WF 관련 연구들에서 고려되던 공격자 모델 사용
{% include articles/figure.html url="/assets/img/heeyong/2019/2019-06-27-fig-wf_scenario.png" legend="Overview of the proposed method." width="50%" %}
  + a passive and local network-level adversary
  + Passive adversary: Tor network을 통해 전달되는 암호화된 트래픽을 확인할 수 있으며, 트래픽 수정, 삽입, 드랍 불가
  + Local adversary: 네트워크의 제한된 부분만 볼 수 있음
  <!-- + ISP-level의 공격자 가정: 복호화가 가능한 level -->
+ WF 연구들에서는 closed world assumption이 일반적임 -> 유저가 공격자가 학습 가능한 페이지들만 방문한다고 가정
  + 하지만 실제 상황과 부합하지 않으므로 본 연구에서는 open world assumption과 closed world assumption을 함께 고려

## Data Collection
+ 암호화된 페이로드는 사용할 수 없기 때문에, 메타 데이터만을 저장
  + 시간 정보(timing information), 방향(direction), TCP 패킷 크기
+ 데이터셋
  + Alexa Top Sites에 있는 웹페이지들을 대상으로 트래픽 수집
  + 종류
    + Closed world: 1,200 개의 웹사이트로부터, 각각 3,000 개의 네트워크 트레이스 -> 타임아웃이나 프레임웍(e.g., 셀레니움) 크래쉬로 인한 항목 제거 -> 정제했다
    + Revisit over time: 첫 데이터 획득 후 3일, 10일, 4주, 6주, 그리고 8주 후, 상위 200개 웹페이지에 대해 각각 500 개의 트레이스 획득
    + Open world: 400,000 개의 트레이스 획득 + Closed world 의 400,000 개 -> 800,000 개 트레이스
      + 테스트 목적으로만 사용했다고 하는데, 기존의 WF 논문들이 Closed world assumption을 기준으로 연구되었기 때문에, 테스트라도 했다는 데에 의의를 두는 것 같음





# Tor 자체에 대한 설명이 없어서
  + tor entry guard라든지, Tor cell 이라든지 이런 부분은 잘 이해가 안 가네






[NLJ+11]: <https://dl.acm.org/citation.cfm?id=2016908> "Nataraj, Lakshmanan, et al. “Malware images: visualization and automatic classification.” Proceedings of the 8th international symposium on visualization for cyber security. ACM, 2011."


## Related work
+ 다음의 네 가지 분석 또는 탐지 방법에 대한 관련 연구 내용 포함
  + Malware Detection Based on Feature Analysis
  + Malicious Code Visualization
  + Image Processing Techniques for Malware Detection
  + Malware Detection Based on Deep Learning


## Malware Detection based on a CNN (proposed method)
{% include articles/figure.html url="/assets/img/heeyong/2019/2019-06-24-fig-proposed-method.png" legend="Overview of the proposed method." %}
+ 제안하는 방법은 상기 그림과 같이 malicious 코드를 grayscale image로 변환; 그리고 CNN 적용을 통한 탐지의 두 단계로 구성됨
+ Binary Malware to Gray image
  + [[NKJ+11]]에서 제안하는 변환 방법 사용 (visualization of executable malware binary files)
    + 먼저 Binary를 8-bit 단위로 나누어 0-255로 표현 -> 10진수의 1-D vector로 변환
    + 1-D vector를 특정 width에 따라 2-D matrix로 변환
      + 특정 width는 [[NKJ+11]]에서 실험을 통해 파일 크기에 따라 고정됨
{% include articles/figure.html url="/assets/img/heeyong/2019/2019-06-24-fig-malware_images.png" legend="Malware Images." %}
  + [[NKJ+11]]에서 보인 Malware Family 내의 유사성과 Family 간의 차이
+ Malware Image Classification Based on CNN
  + CNN은 multidimensional input에 이점
{% include articles/figure.html url="/assets/img/heeyong/2019/2019-06-24-fig-malware_classification.png" legend="Malware Classification." %}
  + 뭔가 새로운 방법을 적용한 줄 알았으나, 일반적인 CNN 사용

[NKJ+11]: <https://dl.acm.org/citation.cfm?id=2016908> "L. Nataraj, S. Karthikeyan, G. Jacob, andB.Manjunath, “Malware images: visualization and automatic classification,” in Proc. 8th Int. Symp. Vis. Cyber Security, 2011, Paper 4."


## Malware Image Data Equilibrium
+ Malware 샘플이 family에 따라 개수의 차이가 있음(데이터 불균형) -> 학습이 제대로 되지 않음(low accuracy & poor robustness)
  + Image Data Augmentation (IDA) Technology
    + 데이터 불균형을 해결하기 위해, 부족한 데이터 확대 -> 과적합 방지
    + 새로운 데이터 생성 방법의 종류
      + rotation/reflection, flip, zoom, shift, scale, contrast, noise, color 등
    + 상기 생성 방법들 중 몇 가지를 임의 선택하여 새로운 데이터 생성
  + Data Equalization Based on a Bat algorithm (DRBAz )
    + Swarm intelligence(집단 지성)에 기반한 데이터 불균형 해결법 제시: Dynamic Resampling method based on the Bat Algorithm
      + Bat Algorithm은 기존에 연구된 내용([[Y10]])
      + 다른 malware family 간의 sampling weight을 최적화하기 위해 사용됨

[Y10]: <https://link.springer.com/chapter/10.1007/978-3-642-12538-6_6> "X.-S.Yang, “A new metaheuristic bat-inspired algorithm,” Nature Inspired Cooperative Strategies for Optimization (NICSO 2010), New York, NY, USA: Springer, pp. 65–74, 2010."


## Experimental Evaluation
+ Caffe framework 사용 (NN framework)
+ Intel Core i5-4590 CPU (3.3 GHz), Nvidia Geforce GTX 750Ti GPU (2 GB), and 8 GB RAM
+ Dataset: 25 Malware Families, 9,342 grayscale images
{% include articles/figure.html url="/assets/img/heeyong/2019/2019-06-24-fig-experimental_results.png" legend="Performances of experimental Results" %}
  + Data Equalization을 통해 Validation 시에 더 나은 성과를 보임을 알 수 있음 (Overfitting 방지)
  + CNN을 수행하기 위해 Image size를 fix해야함에 따라 다양한 Image 크기(reshape)에 따라 실험을 수행함(24*24, 48*48, 96*96, and 192*192)
    + Image의 크기가 클 수록 Training 단계에서의 시간이 많이 소요되게 때문에 추천하는 이미지 크기는 96*96
{% include articles/figure.html url="/assets/img/heeyong/2019/2019-06-24-tbl-comparison.png" legend="Comparison with other approaches" %}
  + Accuracy, Precision, and Recall 모두 높으며, Running time 도 매우 빠름


### Points to note
+ Grayscale image + CNN 을 통한 Malware detection 방법 제안
+ Deep Learning 에서 종종 문제가 되는 데이터 불균형 문제를 해결하기 위한 방법 제시
+ 이를 통해 기존의 Malware detection using image 방법들보다 성능이 좋고 빠른 방법 제시



## Discussion


{% include date/updated.html %}

{% include layout/col_end.html %}
{% include layout/col_start.html column="4 last push1" %}

{% include layout/row_end.html %}
